<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avalanche Smart Contract DApp</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.6.2/ethers.umd.min.js"></script>
    <style>
        body {
            background-color: #1E1E1E;
            color: #FFFFFF;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        .container {
            max-width: 600px;
            margin: auto;
            background: #000000;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0px 0px 15px rgba(255, 0, 0, 0.8);
            border: 2px solid #E84142;
        }
        button {
            padding: 12px;
            margin: 10px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            background: #E84142;
            color: white;
            cursor: pointer;
            transition: 0.3s;
        }
        button:hover {
            background: #FF5A5F;
        }
        #walletAddress {
            font-size: 16px;
            color: #E84142;
            font-weight: bold;
        }
        .transaction-list {
            text-align: left;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
            background: #1E1E1E;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #E84142;
        }
        .transaction {
            border-bottom: 1px solid #E84142;
            padding: 10px;
        }
        a {
            color: #FF5A5F;
            text-decoration: none;
            font-weight: bold;
        }
        a:hover {
            color: #FFFFFF;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2 style="color: #E84142;">Avalanche DApp: Wallet Transactions</h2>
        <button id="connectWallet">Connect Wallet</button>
        <p id="walletAddress"></p>

        <h3 style="color: #E84142;">Transaction History</h3>
        <div id="logResults" class="transaction-list"></div>
    </div>

    <script>
        let provider;
        let signer;
        let userAddress;

        const SNOWTRACE_API_KEY = "YOUR_SNOWTRACE_API_KEY"; // Replace with your API Key
        const SNOWTRACE_API_URL = "https://api-testnet.snowtrace.io/api";

        async function connectWallet() {
            if (window.ethereum) {
                try {
                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = await provider.getSigner();
                    userAddress = await signer.getAddress();
                    document.getElementById("walletAddress").innerText = `Connected: ${userAddress}`;

                    // âœ… Automatically fetch transactions after connecting
                    fetchTransactions(userAddress);
                } catch (error) {
                    alert("Connection failed!");
                }
            } else {
                alert("MetaMask not detected!");
            }
        }

        async function fetchTransactions(address) {
            const logResults = document.getElementById("logResults");
            logResults.innerHTML = "<p>Loading transactions...</p>";

            try {
                const response = await fetch(`${SNOWTRACE_API_URL}?module=account&action=txlist&address=${address}&sort=desc&apikey=${SNOWTRACE_API_KEY}`);
                const data = await response.json();

                if (data.status === "1") {
                    logResults.innerHTML = ""; // Clear previous results

                    data.result.forEach(tx => {
                        logResults.innerHTML += `
                            <div class="transaction">
                                <p><strong>Tx Hash:</strong> <a href="https://testnet.snowtrace.io/tx/${tx.hash}" target="_blank">${tx.hash}</a></p>
                                <p><strong>From:</strong> ${tx.from}</p>
                                <p><strong>To:</strong> ${tx.to}</p>
                                <p><strong>Value:</strong> ${(parseInt(tx.value) / 10**18).toFixed(6)} AVAX</p>
                                <p><strong>Gas Used:</strong> ${tx.gasUsed}</p>
                                <p><strong>Gas Price:</strong> ${(parseInt(tx.gasPrice) / 10**9).toFixed(2)} Gwei</p>
                                <p><strong>Timestamp:</strong> ${new Date(tx.timeStamp * 1000).toLocaleString()}</p>
                                <hr>
                            </div>`;
                    });
                } else {
                    logResults.innerHTML = "<p>No transactions found.</p>";
                }
            } catch (error) {
                console.error("Error fetching transactions:", error);
                logResults.innerHTML = "<p style='color: red;'>Failed to fetch transactions.</p>";
            }
        }

        document.getElementById("connectWallet").addEventListener("click", connectWallet);
    </script>
</body>
</html>
